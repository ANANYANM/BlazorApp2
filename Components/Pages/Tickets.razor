@page "/Tickets"
@using BlazorApp2.Models
@using BlazorApp2.Services
@using Microsoft.AspNetCore.Authorization
@inject TicketService TicketService
@attribute [Authorize(Roles = "Customer")]
<h3>Create Ticket</h3>

<EditForm Model="@newTicket" OnValidSubmit="@HandleValidSubmit" >
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="form-group">
        <label>Ticket ID:</label>
        <InputNumber @bind-Value="newTicket.TicketId" />
    </div>
    <div class="form-group">
        <label>Title:</label>
        <InputText @bind-Value="newTicket.Title" />
    </div>
    <div class="form-group">
        <label>Customer Name:</label>
        <InputText @bind-Value="newTicket.CustomerName" />
    </div>
    <div class="form-group">
        <label>Issue:</label>
        <InputText @bind-Value="newTicket.Issue" />
    </div>
    <div class="form-group">
        <label>Company Name:</label>
        <InputText @bind-Value="newTicket.CompanyName" />
    </div>
    <div class="form-group">
        <label>Issue Category:</label>
        <InputText @bind-Value="newTicket.IssueCategory" />
    </div>
    <div class="form-group">
        <label>Description:</label>
        <InputTextArea @bind-Value="newTicket.Description" />
    </div>
    <div class="form-group">
        <label>Created Date:</label>
        <InputDate @bind-Value="newTicket.CreatedDate" />
    </div>
    <div class="form-group">
        <label>Status:</label>
        <InputText @bind-Value="newTicket.Status" />
    </div>
    <div class="form-group">
        <label>Assign To:</label>
        <InputText @bind-Value="newTicket.AssignTo" />
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>

@if (tickets.Any())
{
    <h3>Tickets List</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Ticket ID</th>
                <th>Customer Name</th>
                <th>Title</th>
                <th>Issue Category</th>
                <th>Description</th>
                <th>Created Date</th>
                <th>Status</th>
                <th>Assign To</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var ticket in tickets)
            {
                <tr>
                    <td>@ticket.TicketId</td>
                    <td>@ticket.CustomerName</td>
                    <td>@ticket.Title</td>
                    <td>@ticket.IssueCategory</td>
                    <td>@ticket.Description</td>
                    <td>@ticket.CreatedDate</td>
                    <td>@ticket.Status</td>
                    <td>@ticket.AssignTo</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private Ticket newTicket = new Ticket();
    private List<Ticket> tickets = new List<Ticket>();
    

    private void HandleValidSubmit()
    {
        TicketService.AddTicket(newTicket);
        tickets = TicketService.GetTickets();
        newTicket = new Ticket(); // Reset the form
    }
}

